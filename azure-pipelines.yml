# Android
# Build your Android project with Gradle.
# Add steps that test, sign, and distribute the APK, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/android
variables:
  platform_version: 27
  device: Nexus5
pool:
  vmImage: 'ubuntu-latest'

steps:
#- task: Gradle@2
#  inputs:
#    workingDirectory: ''
#    gradleWrapperFile: 'gradlew'
#    gradleOptions: '-Xmx3072m'
#    javaHomeOption: 'JDKVersion'
#    jdkVersionOption: '1.8'
#    jdkArchitectureOption: 'x64'
#    publishJUnitResults: true
#    testResultsFiles: '**/TEST-*.xml'
#    tasks: 'assembleDebug test'
#  displayName: gradlew assembleDebug test

#- task: DownloadSecureFile@1
#  name: caCertificate
#  displayName: 'Download CA certificate'
#  inputs:
#    secureFile: 'keystore_debug.jks'

#- task: AndroidSigning@3
#  inputs:
#    apkFiles: '**/*.apk'
#    apksignerKeystoreFile: '$(caCertificate.secureFilePath)'
#    apksignerKeystorePassword: '$(my_key_android)'
#    apksignerKeystoreAlias: 'keystore_debug'
#    apksignerKeyPassword: '$(my_key_android)'
#    zipalign: false

- task: CmdLine@2
  inputs:
    script: |
      PATH=$PATH:$ANDROID_HOME/tools/bin:$ANDROID_HOME/emulator:$ANDROID_HOME/platform-tools
      cat > ~/.android/repositories.cfg
      sudo apt-get install libpulse-dev
      sudo apt-get install cpu-checker
#      echo "+ ------------------------------ +"
#      echo "|     Configurando emulador      |"
#      echo "+ ------------------------------ +"     
#      sdkmanager 'emulator'
#
#      echo "ANDROID_HOME =  "$ANDROID_HOME
#      echo "ANDROID_SDK_ROOT =  "$ANDROID_SDK_ROOT
#      PATH=$PATH:$ANDROID_HOME/emulator
#      sdkmanager --update  
#      echo "+ ------------------------------ +"
#      echo "|     Paquetes instalados        |"
#      echo "+ ------------------------------ +"
#      #echo y | sdkmanager --list 
#
#      echo "+ ------------------------------ +"
#      echo "|         Instalando             |"
#      echo "+ ------------------------------ +"
#      echo y | sdkmanager --install 'system-images;android-27;google_apis;x86'
#
#      echo "+ ------------------------------ +"
#      echo "|         Creando emulador       |"
#      echo "+ ------------------------------ +"
#      echo no | avdmanager create avd --force --name EMULATOR_API_27 --abi google_apis/x86 --package 'system-images;android-27;google_apis;x86' --device "Nexus 5X"
#      
#      echo "+ ------------------------------ +"
#      echo "|       Listando emuladores      |"
#      echo "+ ------------------------------ +"
#      emulator -list-avds
# 
#      echo "+ ------------------------------ +"
#      echo "|            Show avd            |"
#      echo "+ ------------------------------ +"
#      echo "----------------->  cd ~/.android/"
#      cd ~/.android/
#      ls
#      echo "----------------->  cd ~/.android/avd/"
#      cd ~/.android/avd/
#      pwd
#      ls
# 
#      echo "+ ------------------------------ +"
#      echo "|          adb devices           |"
#      echo "+ ------------------------------ +"
#      adb devices
# 
#      echo "+ ------------------------------ +"
#      echo "|       Iniciando emulador       |"
#      echo "+ ------------------------------ +"
# 
#      emulator -avd EMULATOR_API_27 -no-audio -wipe-data -no-cache -no-boot-anim -no-snapstorage
#      echo "+ ------------------------------ +"
#      echo "|          adb devices           |"
#      echo "+ ------------------------------ +"
#      adb devices
# 
#      echo "+ ------------------------------ +"
#      echo "|       Delete emulador          |"
#      echo "+ ------------------------------ +"
#      avdmanager delete avd -n EMULATOR_API_27      
#      #rm -rf EMULATOR_API_*.*
# 
#      echo "+ ------------------------------ +"
#      echo "|       Listando emuladores      |"
#      echo "+ ------------------------------ +"
#      emulator -list-avds
#
#      set -e pipefail
#      # Install AVD files
#      #echo "y" | $ANDROID_HOME/tools/bin/sdkmanager --install 'system-images;android-27;google_apis;x86'
#      #
#      ## Create emulator
#      #echo "no" | $ANDROID_HOME/tools/bin/avdmanager create avd -n xamarin_android_emulator -k 'system-images;android-27;google_apis;x86' --force
#      #
#      #$ANDROID_HOME/emulator/emulator -list-avds
#      #
#      #echo "Starting emulator"
#      #
#      ## Start emulator in background
#      #nohup $ANDROID_HOME/emulator/emulator -avd xamarin_android_emulator -no-snapshot > /dev/null 2>&1 &
#      #$ANDROID_HOME/platform-tools/adb wait-for-device shell 'while [[ -z $(getprop sys.boot_completed | tr -d '\r') ]]; do sleep 1; done; input keyevent 82'
#      #
#      #$ANDROID_HOME/platform-tools/adb devices
#      #
#      #echo "Emulator started"
  displayName: Emulator started
  
#- task: CopyFiles@2
#  inputs:
#    contents: '**/*.apk'
#    targetFolder: '$(build.artifactStagingDirectory)'
#  displayName: Copy .apk files to artifact staging directory
#
#- task: PublishBuildArtifacts@1
#  inputs:
#    pathToPublish: '$(build.artifactStagingDirectory)'
#    artifactName: 'drop'
#    artifactType: 'container'
#  displayName: Publish artifacts